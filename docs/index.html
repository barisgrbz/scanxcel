<!DOCTYPE html>
<html>
<head>
  <base href="/scanxcel/">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="ScanXcel v1.3 - Modern, responsive cross-platform barcode scanning and Excel export application with advanced features">
  <meta name="keywords" content="barcode scanner, QR code, Excel export, mobile app, web app, productivity, business">
  <meta name="author" content="ScanXcel Team">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://barisgrbz.github.io/scanxcel/">
  <meta property="og:title" content="ScanXcel v1.3 - Advanced Barcode Scanner">
  <meta property="og:description" content="Modern, responsive cross-platform barcode scanning and Excel export application">
  <meta property="og:image" content="icons/Icon-512.png">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://barisgrbz.github.io/scanxcel/">
  <meta property="twitter:title" content="ScanXcel v1.3 - Advanced Barcode Scanner">
  <meta property="twitter:description" content="Modern, responsive cross-platform barcode scanning and Excel export application">
  <meta property="twitter:image" content="icons/Icon-512.png">
  
  <!-- Kamera izinleri iÃ§in gÃ¼venlik politikalarÄ± -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https:; media-src 'self' blob: data: https:; connect-src 'self' blob: wss: https:;">
  <meta http-equiv="Permissions-Policy" content="camera=*">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="ScanXcel">
  <link rel="apple-touch-icon" href="icons/icon.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="icons/icon.png"/>
  <link rel="shortcut icon" type="image/png" href="icons/icon.png"/>

  <title>ScanXcel v1.3 - Advanced Barcode Scanner & Excel Export</title>
  <link rel="manifest" href="manifest.json">
  
  <!-- ZXing Barcode Scanner Library -->
  <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
  
  <!-- Barcode Scanner JavaScript -->
  <script>
    let codeReader = null;
    let selectedDeviceId = null;
    let isScanning = false;
    
    // ZXing yÃ¼klendiÄŸinde scanner'Ä± hazÄ±rla - Samsung S20 uyumlu
    function initializeScanner() {
      if (typeof ZXing !== 'undefined') {
        // Tek MultiFormat reader - hem 1D hem 2D destekliyor
        codeReader = new ZXing.BrowserMultiFormatReader();
        
        // Samsung S20 tespiti
        const isSamsungS20 = navigator.userAgent.includes('SM-G980') || 
                            navigator.userAgent.includes('SM-G981') || 
                            navigator.userAgent.includes('SM-G985') || 
                            navigator.userAgent.includes('SM-G986');
        
        if (isSamsungS20) {
          console.log('ğŸ”§ ZXing MultiFormat scanner hazÄ±rlandÄ± - Samsung S20 modu');
          console.log('ğŸ“± Samsung S20 model tespit edildi');
        } else {
          console.log('ğŸ”§ ZXing MultiFormat scanner hazÄ±rlandÄ±');
        }
      } else {
        console.error('âŒ ZXing yÃ¼klenemedi');
      }
    }
    
    // Kamera listesini al
    async function getCameras() {
      try {
        const videoInputDevices = await codeReader.listVideoInputDevices();
        console.log('ğŸ“¹ Bulunan kameralar:', videoInputDevices.length);
        return videoInputDevices;
      } catch (err) {
        console.error('âŒ Kamera listesi alÄ±namadÄ±:', err);
        return [];
      }
    }
    
    // GeliÅŸmiÅŸ kamera baÅŸlatma - Samsung S20 uyumlu
    async function setupCamera(videoElementId, deviceId = null) {
      try {
        // Samsung S20 iÃ§in optimize edilmiÅŸ constraints
        const constraints = {
          video: {
            deviceId: deviceId ? { exact: deviceId } : undefined,
            width: { ideal: 1920, min: 640, max: 1920 },
            height: { ideal: 1080, min: 480, max: 1080 },
            facingMode: deviceId ? undefined : 'environment',
            focusMode: 'continuous',
            exposureMode: 'auto',
            whiteBalanceMode: 'auto',
            // Samsung S20 iÃ§in ek ayarlar
            frameRate: { ideal: 30, min: 15, max: 60 },
            aspectRatio: { ideal: 16/9 },
            // DÃ¼ÅŸÃ¼k Ä±ÅŸÄ±k performansÄ±
            torch: false
          }
        };
        
        console.log('ğŸ“± Samsung S20 uyumlu kamera ayarlarÄ±:', constraints);
        
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        const videoElement = document.getElementById(videoElementId);
        
        if (videoElement) {
          videoElement.srcObject = stream;
          
          // Samsung S20 iÃ§in video element ayarlarÄ±
          videoElement.style.objectFit = 'cover';
          videoElement.style.transform = 'scaleX(-1)'; // Mirror effect
          
          console.log('ğŸ¥ Kamera stream baÅŸarÄ±yla baÅŸlatÄ±ldÄ±');
          console.log('ğŸ“ Video boyutlarÄ±:', videoElement.videoWidth, 'x', videoElement.videoHeight);
          console.log('ğŸ“± Cihaz bilgisi:', navigator.userAgent);
          
          return stream;
        }
      } catch (err) {
        console.error('âŒ Kamera baÅŸlatma hatasÄ±:', err);
        console.error('ğŸ“± Cihaz:', navigator.userAgent);
        throw err;
      }
    }
    
    // TaramayÄ± baÅŸlat
    async function startScanning(videoElementId, deviceId = null) {
      if (!codeReader || isScanning) return;
      
      try {
        isScanning = true;
        selectedDeviceId = deviceId;
        
        const result = await codeReader.decodeOnceFromVideoDevice(deviceId, videoElementId);
        
        if (result) {
          console.log('Barkod tarandÄ±:', result.text);
          window.scannedResult = result.text;
          stopScanning();
          return result.text;
        }
      } catch (err) {
        console.error('Tarama hatasÄ±:', err);
        isScanning = false;
      }
    }
    
    // SÃ¼rekli tarama - Optimize edilmiÅŸ
    async function startContinuousScanning(videoElementId, deviceId = null) {
      if (!codeReader || isScanning) return;
      
      try {
        isScanning = true;
        selectedDeviceId = deviceId;
        
        // Tarama ayarlarÄ±nÄ± optimize et - Samsung S20 iÃ§in Ã¶zel
        const hints = new Map();
        hints.set(ZXing.DecodeHintType.TRY_HARDER, true);
        hints.set(ZXing.DecodeHintType.PURE_BARCODE, false);
        hints.set(ZXing.DecodeHintType.ASSUME_GS1, false);
        hints.set(ZXing.DecodeHintType.ALSO_INVERTED, true);
        
        // Samsung S20 iÃ§in Ã¶zel ayarlar
        hints.set(ZXing.DecodeHintType.ALLOWED_EAN_EXTENSIONS, [2, 5]);
        hints.set(ZXing.DecodeHintType.ASSUME_CODE_39_CHECK_DIGIT, false);
        hints.set(ZXing.DecodeHintType.RETURN_CODABAR_START_END, false);
        
        // Samsung S20 iÃ§in ek optimizasyonlar
        hints.set(ZXing.DecodeHintType.CHARACTER_SET, 'UTF-8');
        hints.set(ZXing.DecodeHintType.NEED_RESULT_POINT_CALLBACK, false);
        
        // Cihaz tespiti
        const isSamsungS20 = navigator.userAgent.includes('SM-G980') || 
                            navigator.userAgent.includes('SM-G981') || 
                            navigator.userAgent.includes('SM-G985') || 
                            navigator.userAgent.includes('SM-G986');
        
        if (isSamsungS20) {
          console.log('ğŸ“± Samsung S20 tespit edildi - Ã¶zel optimizasyonlar aktif');
          // Samsung S20 iÃ§in daha agresif ayarlar
          hints.set(ZXing.DecodeHintType.TRY_HARDER, true);
          hints.set(ZXing.DecodeHintType.PURE_BARCODE, true);
        }
        
        // Format Ã¶nceliÄŸi: Samsung S20 iÃ§in optimize edilmiÅŸ
        let allFormats;
        
        if (isSamsungS20) {
          // Samsung S20 iÃ§in Ã¶zel format sÄ±ralamasÄ±
          allFormats = [
            // En yaygÄ±n 1D barkodlar - Samsung S20'de daha iyi Ã§alÄ±ÅŸÄ±r
            ZXing.BarcodeFormat.CODE_128,
            ZXing.BarcodeFormat.EAN_13,
            ZXing.BarcodeFormat.UPC_A,
            ZXing.BarcodeFormat.CODE_39,
            
            // DiÄŸer 1D formatlar
            ZXing.BarcodeFormat.EAN_8,
            ZXing.BarcodeFormat.UPC_E,
            ZXing.BarcodeFormat.CODE_93,
            ZXing.BarcodeFormat.ITF,
            ZXing.BarcodeFormat.CODABAR,
            
            // 2D kodlar
            ZXing.BarcodeFormat.QR_CODE,
            ZXing.BarcodeFormat.DATA_MATRIX,
            ZXing.BarcodeFormat.PDF_417,
            ZXing.BarcodeFormat.AZTEC,
            
            // RSS formatlar (Samsung S20'de daha az yaygÄ±n)
            ZXing.BarcodeFormat.RSS_14,
            ZXing.BarcodeFormat.RSS_EXPANDED,
            ZXing.BarcodeFormat.MAXICODE
          ];
          console.log('ğŸ“± Samsung S20 format Ã¶nceliÄŸi aktif');
        } else {
          // DiÄŸer cihazlar iÃ§in standart format sÄ±ralamasÄ±
          allFormats = [
            // YaygÄ±n 1D Ã¼rÃ¼n barkodlarÄ± - Ã¶ncelik
            ZXing.BarcodeFormat.EAN_13,
            ZXing.BarcodeFormat.EAN_8,
            ZXing.BarcodeFormat.UPC_A,
            ZXing.BarcodeFormat.UPC_E,
            
            // Esnek uzunluklu 1D barkodlar
            ZXing.BarcodeFormat.CODE_128,
            ZXing.BarcodeFormat.CODE_39,
            ZXing.BarcodeFormat.CODE_93,
            
            // DiÄŸer 1D formatlar
            ZXing.BarcodeFormat.ITF,
            ZXing.BarcodeFormat.CODABAR,
            ZXing.BarcodeFormat.RSS_14,
            ZXing.BarcodeFormat.RSS_EXPANDED,
            
            // 2D kodlar - sonra
            ZXing.BarcodeFormat.QR_CODE,
            ZXing.BarcodeFormat.DATA_MATRIX,
            ZXing.BarcodeFormat.PDF_417,
            ZXing.BarcodeFormat.AZTEC,
            ZXing.BarcodeFormat.MAXICODE
          ];
        }
        
        hints.set(ZXing.DecodeHintType.POSSIBLE_FORMATS, allFormats);
        codeReader.hints = hints;
        
        console.log('ğŸ“Š Aktif barkod formatlarÄ±:', allFormats.length);
        if (isSamsungS20) {
          console.log('ğŸ¯ Samsung S20 Ã¶zel tarama (CODE-128, EAN-13, UPC-A Ã¶ncelikli)');
        } else {
          console.log('ğŸ¯ Standart 1D barkod Ã¶ncelikli tarama (EAN-13, UPC, CODE-128)');
        }
        
        // Tek MultiFormat tarama - Samsung S20 optimize
        codeReader.decodeFromVideoDevice(deviceId, videoElementId, (result, err) => {
          if (result && result.text) {
            console.log('âœ… Barkod tarandÄ±:', result.text, 'Format:', result.format);
            
            // Format-specific debug
            if (result.format === ZXing.BarcodeFormat.EAN_13) {
              console.log('ğŸ·ï¸ EAN-13 Ã¼rÃ¼n barkodu algÄ±landÄ±!');
            } else if (result.format === ZXing.BarcodeFormat.CODE_128) {
              console.log('ğŸ“¦ CODE-128 barkodu algÄ±landÄ±!');
            } else if (result.format === ZXing.BarcodeFormat.UPC_A) {
              console.log('ğŸ›’ UPC-A barkodu algÄ±landÄ±!');
            } else if (result.format === ZXing.BarcodeFormat.CODE_39) {
              console.log('ğŸ”¢ CODE-39 barkodu algÄ±landÄ±!');
            }
            
            // Samsung S20 Ã¶zel log
            if (isSamsungS20) {
              console.log('ğŸ“± Samsung S20 baÅŸarÄ±lÄ± tarama:', result.text);
            }
            
            window.scannedResult = result.text;
            stopScanning();
          }
          // Tarama hatalarÄ±nÄ± console'da gÃ¶ster
          if (err && !(err instanceof ZXing.NotFoundException)) {
            if (isSamsungS20) {
              console.log('ğŸ” Samsung S20 tarama devam ediyor...', err.name);
            } else {
              console.log('ğŸ” Tarama devam ediyor...');
            }
          }
        });
        
        console.log('ğŸ¥ MultiFormat tarama baÅŸlatÄ±ldÄ±');
      } catch (err) {
        console.error('âŒ SÃ¼rekli tarama hatasÄ±:', err);
        isScanning = false;
      }
    }
    
    // TaramayÄ± durdur
    function stopScanning() {
      if (codeReader && isScanning) {
        codeReader.reset();
        isScanning = false;
        console.log('ğŸ›‘ Tarama durduruldu');
      }
    }
    
    // Sayfa yÃ¼klendiÄŸinde scanner'Ä± hazÄ±rla
    window.addEventListener('load', function() {
      setTimeout(initializeScanner, 1000);
    });
  </script>

  <script>
    // The value below is injected by flutter build, do not touch.
    const serviceWorkerVersion = "1513142016";
  </script>
  <!-- This script adds the flutter initialization JS code -->
  <script src="flutter.js" defer></script>
</head>
<body>
  <script>
    // Global deÄŸiÅŸkenler
    window.videoElement = null;
    window.flutter_barcode_result = null;
    
    // Kamera izinlerini kontrol et
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
      console.log('Kamera API destekleniyor');
    } else {
      console.log('Kamera API desteklenmiyor');
    }
    
    window.addEventListener('load', function(ev) {
      // Download main.dart.js
      _flutter.loader.loadEntrypoint({
        serviceWorker: {
          serviceWorkerVersion: serviceWorkerVersion,
        },
        onEntrypointLoaded: function(engineInitializer) {
          engineInitializer.initializeEngine().then(function(appRunner) {
            appRunner.runApp();
          });
        }
      });
    });
  </script>
</body>
</html>

